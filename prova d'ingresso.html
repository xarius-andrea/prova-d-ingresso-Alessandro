<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Visualizzatore SVG — Pagine 1–24</title>
  <style>
    :root{--bg:#f6f7fb;--panel:#fff;--muted:#666}
    html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial}
    body{display:flex;flex-direction:column;background:var(--bg);color:#111}
    header{padding:12px 16px;background:linear-gradient(90deg,#fff, #f3f5fb);box-shadow:0 1px 0 rgba(0,0,0,0.04);display:flex;gap:12px;align-items:center}
    h1{font-size:16px;margin:0}
    .controls{margin-left:auto;display:flex;gap:8px;align-items:center}
    button{background:#1f6feb;color:white;border:none;padding:8px 12px;border-radius:8px;cursor:pointer}
    button:disabled{opacity:.5;cursor:not-allowed}
    input[type=number]{width:72px;padding:8px;border-radius:8px;border:1px solid #ddd}
    main{flex:1;display:flex;flex-direction:column;gap:8px;padding:12px}
    .viewer-wrap{flex:1;background:var(--panel);border-radius:10px;box-shadow:0 6px 20px rgba(19,24,40,0.06);overflow:hidden;display:flex;flex-direction:column}
    .viewer-top{padding:8px 12px;border-bottom:1px solid #eee;display:flex;align-items:center;gap:12px}
    .meta{font-size:13px;color:var(--muted)}
    .svg-frame{flex:1;display:block;border:0;width:100%;height:100%}
    .fallback{padding:18px;text-align:center}
    @media (min-width:900px){
      main{padding:18px}
    }
  </style>
</head>
<body>
  <header>
    <h1>Visualizzatore SVG (1–24)</h1>
    <div class="controls" role="group" aria-label="Controlli pagine">
      <button id="prevBtn">◀ Precedente</button>
      <button id="nextBtn">Successiva ▶</button>
      <label class="meta" for="pageInput">Vai a:</label>
      <input id="pageInput" type="number" min="1" max="24" value="1" aria-label="Numero pagina" />
      <button id="goBtn">Vai</button>
    </div>
  </header>

  <main>
    <div class="viewer-wrap">
      <div class="viewer-top">
        <div class="meta" id="pageLabel">Pagina 1 di 24</div>
        <div style="margin-left:auto" class="meta">Usa ← e → per navigare</div>
      </div>

      <!-- usa <object> così l'SVG mantiene dimensioni e rimane navigabile -->
      <object id="svgViewer" class="svg-frame" data="https://svg.issuu.com/250331084348-14b826c7bb9ddd32d79bd31dc03744c9/page_1.svg" type="image/svg+xml">
        <div class="fallback">
          <p>Il browser non supporta l'elemento <code>object</code> oppure il file non è raggiungibile.</p>
          <p>Apri manualmente: <a id="directLink" href="#" target="_blank" rel="noopener">Apri SVG</a></p>
        </div>
      </object>
    </div>
  </main>

  <script>
    (function(){
      const base = 'https://svg.issuu.com/250331084348-14b826c7bb9ddd32d79bd31dc03744c9/page_';
      const ext = '.svg';
      const total = 24;

      const prevBtn = document.getElementById('prevBtn');
      const nextBtn = document.getElementById('nextBtn');
      const goBtn = document.getElementById('goBtn');
      const pageInput = document.getElementById('pageInput');
      const pageLabel = document.getElementById('pageLabel');
      const svgViewer = document.getElementById('svgViewer');
      const directLink = document.getElementById('directLink');

      let page = 1;

      function fmt(n){ return String(n); }

      function updateViewer(){
        // protezioni sui limiti
        if(page < 1) page = 1;
        if(page > total) page = total;

        const url = base + fmt(page) + ext;
        svgViewer.setAttribute('data', url);
        directLink.href = url;
        directLink.textContent = url;
        pageInput.value = page;
        pageLabel.textContent = `Pagina ${page} di ${total}`;

        prevBtn.disabled = (page === 1);
        nextBtn.disabled = (page === total);

        // prova a riloggare eventuali errori semplici nella console
        console.log('Caricando', url);
      }

      prevBtn.addEventListener('click', ()=>{ page = Math.max(1, page-1); updateViewer(); });
      nextBtn.addEventListener('click', ()=>{ page = Math.min(total, page+1); updateViewer(); });
      goBtn.addEventListener('click', ()=>{ const v = Number(pageInput.value) || 1; page = Math.min(total, Math.max(1, v)); updateViewer(); });

      pageInput.addEventListener('keydown', (e)=>{ if(e.key === 'Enter') goBtn.click(); });

      // tasti sinistra/destra
      window.addEventListener('keydown', (e)=>{
        if(e.key === 'ArrowLeft') prevBtn.click();
        if(e.key === 'ArrowRight') nextBtn.click();
      });

      // carica pagina iniziale (eventuale parametro ?p=)
      const params = new URLSearchParams(location.search);
      const p = parseInt(params.get('p'));
      if(Number.isInteger(p) && p >=1 && p <= total){ page = p; }

      updateViewer();

      // supporto semplice per cambiare pagina anche con hash (#3)
      window.addEventListener('hashchange', ()=>{
        const h = location.hash.replace('#','');
        const n = parseInt(h);
        if(Number.isInteger(n)) { page = Math.min(total, Math.max(1, n)); updateViewer(); }
      });

      // quando la pagina cambia, aggiorno l'hash (ma non creo history eccessiva)
      const origPushState = history.pushState;
      function setHashForPage(){ location.hash = String(page); }

      // aggiorno hash ogni volta che cambia la pagina (debounced non necessario qui)
      const observer = new MutationObserver(()=> setHashForPage());
      observer.observe(pageLabel, {childList:true});

    })();
  </script>
</body>
</html>
